{% extends "mahasiswa/base.html" %}
{% block content %}

<div class="bg-white p-8 rounded-3xl shadow-xl border border-gray-100">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">Detail Laporan #{{ report.id }}</h1>
    <p class="text-lg text-gray-500 border-b pb-4 mb-6">Status Laporan: 
        <span class="text-xl font-bold px-3 py-1 rounded-lg 
            {% if report.status == 'Pending' %} bg-yellow-100 text-yellow-800 border border-yellow-300 
            {% elif report.status == 'Diproses' %} bg-blue-100 text-blue-800 border border-blue-300 
            {% elif report.status == 'Selesai' %} bg-green-100 text-green-800 border border-green-300 
            {% endif %}">
            {{ report.status.upper() }}
        </span>
    </p>

    <!-- Detail Laporan -->
    <div class="mb-8 border-b pb-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-3">{{ report.judul }}</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
            <p class="text-gray-600"><i class="fas fa-tags mr-2 text-indigo-500"></i> Kategori: <span class="font-semibold">{{ report.kategori }}</span></p>
            <p class="text-gray-600"><i class="fas fa-user-tag mr-2 text-red-500"></i> Ditugaskan ke: <span class="font-semibold">{{ report.assigned_to_role | upper }}</span></p>
            <p class="text-gray-600"><i class="fas fa-calendar-alt mr-2 text-green-500"></i> Diajukan: <span class="font-semibold">{{ report.created_at.strftime('%d %b %Y, %H:%M') }}</span></p>
            <p class="text-gray-600"><i class="fas fa-history mr-2 text-yellow-500"></i> Terakhir Update: <span class="font-semibold">{{ report.updated_at.strftime('%d %b %Y, %H:%M') }}</span></p>
        </div>
        
        <h3 class="text-lg font-bold text-gray-800 mt-4 mb-2">Deskripsi Aduan:</h3>
        <p class="text-gray-700 leading-relaxed whitespace-pre-wrap">{{ report.deskripsi }}</p>

        {% if report.bukti_url %}
        <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
            <p class="text-sm font-bold text-gray-700 mb-1"><i class="fas fa-paperclip mr-2"></i> Bukti Terlampir:</p>
            <!-- Link ke file upload. Kita perlu memisahkan path untuk Flask static/uploads -->
            <a href="{{ url_for('static', filename=report.bukti_url) }}" target="_blank" class="text-blue-600 hover:text-blue-800 hover:underline text-sm break-all">
                {{ report.bukti_url.split('/')[-1] }} <i class="fas fa-external-link-alt ml-1"></i>
            </a>
            <p class="text-xs text-gray-500 mt-1">
                Akses link: <code>{{ url_for('static', filename=report.bukti_url) }}</code>
            </p>
        </div>
        {% endif %}
    </div>

    <!-- Riwayat Balasan / Komentar -->
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Riwayat Komunikasi ({{ comments | length }})</h2>

    <div class="space-y-6">
        {% for comment in comments %}
        {% set is_mahasiswa = comment.user.role == 'mahasiswa' %}
        
        <div class="flex {{ 'justify-end' if is_mahasiswa else 'justify-start' }}">
            <div class="max-w-lg w-full p-4 rounded-xl shadow-md 
                {{ 'bg-indigo-50 border-2 border-indigo-200' if is_mahasiswa else 'bg-gray-100 border-2 border-gray-300' }}">
                
                <p class="text-xs font-semibold {{ 'text-indigo-600' if is_mahasiswa else 'text-red-600' }} mb-1">
                    {{ comment.user.nama_lengkap }} ({{ comment.user.role.upper() }})
                </p>
                <p class="text-gray-800">{{ comment.komentar }}</p>
                <p class="text-xs text-gray-500 mt-2 text-right">{{ comment.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
            </div>
        </div>
        {% endfor %}
        
        {% if not comments %}
        <div class="text-center py-6 border-dashed border-2 border-gray-300 rounded-xl bg-gray-50">
            <p class="text-gray-500 italic">Belum ada balasan dari Admin atau Bagian Terkait.</p>
        </div>
        {% endif %}
    </div>
    
    <div class="mt-8 text-center">
        <a href="{{ url_for('mahasiswa.dashboard') }}" class="text-lg font-medium text-blue-600 hover:text-blue-800">
            <i class="fas fa-arrow-left mr-2"></i> Kembali ke Dashboard
        </a>
    </div>
</div>
{% endblock content %}